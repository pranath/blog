<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Train a model quickly with Amazon SageMaker Autopilot</h1><p class="page-description">We will use Amazon Sagemaker Autopilot to automatically train a natural language processing (NLP) model. The model will analyze customer feedback and classify the messages into positive (1), neutral (0) and negative (-1) sentiment.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-02-05T00:00:00-06:00" itemprop="datePublished">
        Feb 5, 2023
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      27 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#aws">aws</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#cloud-data-science">cloud-data-science</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#natural-language-processing">natural-language-processing</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h2"><a href="#Use-case:-Analyze-Customer-Sentiment">Use case: Analyze Customer Sentiment </a></li>
<li class="toc-entry toc-h2"><a href="#Review-transformed-dataset">Review transformed dataset </a></li>
<li class="toc-entry toc-h2"><a href="#Configure-the-Autopilot-job">Configure the Autopilot job </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Upload-data-to-S3-bucket">Upload data to S3 bucket </a></li>
<li class="toc-entry toc-h3"><a href="#S3-output-for-generated-assets">S3 output for generated assets </a></li>
<li class="toc-entry toc-h3"><a href="#Configure-the-Autopilot-job">Configure the Autopilot job </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Launch-the-Autopilot-job">Launch the Autopilot job </a></li>
<li class="toc-entry toc-h2"><a href="#Track-Autopilot-job-progress">Track Autopilot job progress </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Autopilot-job-description">Autopilot job description </a></li>
<li class="toc-entry toc-h3"><a href="#Autopilot-job-status">Autopilot job status </a></li>
<li class="toc-entry toc-h3"><a href="#Review-the-SageMaker-processing-jobs">Review the SageMaker processing jobs </a></li>
<li class="toc-entry toc-h3"><a href="#Wait-for-the-data-analysis-step-to-finish">Wait for the data analysis step to finish </a></li>
<li class="toc-entry toc-h3"><a href="#View-generated-notebooks">View generated notebooks </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Feature-engineering">Feature engineering </a></li>
<li class="toc-entry toc-h2"><a href="#Model-training-and-tuning">Model training and tuning </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Compare-model-candidates">Compare model candidates </a></li>
<li class="toc-entry toc-h3"><a href="#Review-best-candidate">Review best candidate </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Review-all-output-in-S3-bucket">Review all output in S3 bucket </a></li>
<li class="toc-entry toc-h2"><a href="#Deploy-and-test-best-candidate-model">Deploy and test best candidate model </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Deploy-best-candidate-model">Deploy best candidate model </a></li>
<li class="toc-entry toc-h3"><a href="#Test-the-model">Test the model </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Acknowledgements">Acknowledgements </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-02-05-train-model-aws-sagemaker-autopilot.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In an <a href="https://livingdatalab.com/aws/cloud-data-science/natural-language-processing/2023/02/03/loading-transforming-clothes-reviews-text-aws.html">earlier article we introduced AWS cloud services for data science</a>, and how it can help with different stages of the data science &amp; machine learning workflow.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/aws_ds_workflow.png" alt="" title="The AWS Data Science Workflow"></p>
<p>In this article, we will use <strong>Amazon Sagemaker Autopilot</strong> to train a natural language processing (NLP) model. The model will analyze customer feedback and classify the messages into positive (1), neutral (0) and negative (-1) sentiment.</p>
<p>Amazon SageMaker Autopilot automatically trains and tunes the best machine learning models for classification or regression, based on your data while allowing to maintain full control and visibility.</p>
<p>SageMaker Autopilot is an example of <strong>AutoML</strong>, much like <a href="https://livingdatalab.com/categories/#pycaret">Pycaret</a> which I have written about previously. In comparison, not only is Autopilot even more automated than Pycaret, it is also designed to work at large scale as is possible with <a href="https://livingdatalab.com/categories/#cloud-data-science">cloud data science solutions</a>.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/aws_automl.png" alt="" title="Amazon Sagemaker Autopilot - Solutions"></p>
<p>SageMaker Autopilot will inspect the raw dataset, apply feature processors, pick the best set of algorithms, train and tune multiple models, and then rank the models based on performance - all with just a few clicks.  Autopilot transparently generates a set of Python scripts and notebooks for a complete end-to-end pipeline including data analysis, candidate generation, feature engineering, and model training/tuning.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/aws_automl2.png" alt="" title="Amazon Sagemaker Autopilot - Details"></p>
<p>SageMaker Autopilot job consists of the following high-level steps:</p>
<ul>
<li>
<em>Data analysis</em> where the data is summarized and analyzed to determine which feature engineering techniques, hyper-parameters, and models to explore.</li>
<li>
<em>Feature engineering</em> where the data is scrubbed, balanced, combined, and split into train and validation.</li>
<li>
<em>Model training and tuning</em> where the top performing features, hyper-parameters, and models are selected and trained.</li>
</ul>
<p>These re-usable scripts and notebooks give us full visibility into how the model candidates were created.  Since Autopilot integrates natively with SageMaker Studio, we can visually explore the different models generated by SageMaker Autopilot.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/aws_automl3.png" alt="" title="Amazon Sagemaker Autopilot - Overview"></p>
<p>SageMaker Autopilot can be used by people without machine learning experience to automatically train a model from a dataset.  Additionally, experienced developers can use Autopilot to train a baseline model from which they can iterate and manually improve.</p>
<p>Autopilot is available through the SageMaker Studio UI and AWS Python SDK.  In this project, we will use the AWS Python SDK to train a series of text-classification models and deploy the model with the highest accuracy.</p>
<p>For more details on Autopilot, please refer to this <a href="https://www.amazon.science/publications/amazon-sagemaker-autopilot-a-white-box-automl-solution-at-scale"><strong>Amazon Science Publication</strong></a>.</p>
<h2 id="Use-case:-Analyze-Customer-Sentiment">
<a class="anchor" href="#Use-case:-Analyze-Customer-Sentiment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use case: Analyze Customer Sentiment<a class="anchor-link" href="#Use-case:-Analyze-Customer-Sentiment"> </a>
</h2>
<p>Customer feedback appears across many channels including social media and partner websites.  As a company, you want to capture this valuable product feedback to spot negative trends and improve the situation, if needed. Here we will train a model to classify the feedback messages into positive (1), neutral (0) and negative (-1) sentiment.</p>
<p>First, let's install and import required modules.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">sagemaker</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">botocore</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">botocore</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">user_agent_extra</span><span class="o">=</span><span class="s1">'dlai-pds/c1/w3'</span><span class="p">)</span>

<span class="c1"># low-level service client of the boto3 session</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">'sagemaker'</span><span class="p">,</span> 
                  <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="n">sm_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'sagemaker-runtime'</span><span class="p">,</span>
                          <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">sagemaker_client</span><span class="o">=</span><span class="n">sm</span><span class="p">,</span>
                         <span class="n">sagemaker_runtime_client</span><span class="o">=</span><span class="n">sm_runtime</span><span class="p">)</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">role</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">boto_region_name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format='retina'
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Review-transformed-dataset">
<a class="anchor" href="#Review-transformed-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Review transformed dataset<a class="anchor-link" href="#Review-transformed-dataset"> </a>
</h2>
<p>Let's transform the dataset into a format that Autopilot recognizes.  Specifically, a comma-separated file of <code>label,features</code> as shown here:</p>

<pre><code>sentiment,review_body
-1,"this is bad"
0,"this is ok"
1,"this is great"
...</code></pre>
<p>Sentiment is one of three classes: negative (-1), neutral (0), or positive (1).  Autopilot requires that the target variable, <code>sentiment</code> is first and the set of features, just <code>review_body</code> in this case, come next.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws s3 cp <span class="s1">'s3://dlai-practical-data-science/data/balanced/womens_clothing_ecommerce_reviews_balanced.csv'</span> ./
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>download: s3://dlai-practical-data-science/data/balanced/womens_clothing_ecommerce_reviews_balanced.csv to ./womens_clothing_ecommerce_reviews_balanced.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">'./womens_clothing_ecommerce_reviews_balanced.csv'</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">','</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sentiment</th>
      <th>review_body</th>
      <th>product_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1</td>
      <td>This suit did nothing for me. the top has zero...</td>
      <td>Swim</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1</td>
      <td>Like other reviewers  i saw this dress on the ...</td>
      <td>Dresses</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1</td>
      <td>I wish i had read the reviews before purchasin...</td>
      <td>Knits</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1</td>
      <td>I ordered these pants in my usual size (xl) an...</td>
      <td>Legwear</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1</td>
      <td>I noticed this top on one of the sales associa...</td>
      <td>Knits</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path_autopilot</span> <span class="o">=</span> <span class="s1">'./womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv'</span>

<span class="n">df</span><span class="p">[[</span><span class="s1">'sentiment'</span><span class="p">,</span> <span class="s1">'review_body'</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_autopilot</span><span class="p">,</span> 
                                        <span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">,</span> 
                                        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Configure-the-Autopilot-job">
<a class="anchor" href="#Configure-the-Autopilot-job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the Autopilot job<a class="anchor-link" href="#Configure-the-Autopilot-job"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Upload-data-to-S3-bucket">
<a class="anchor" href="#Upload-data-to-S3-bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upload data to S3 bucket<a class="anchor-link" href="#Upload-data-to-S3-bucket"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopilot_train_s3_uri</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">upload_data</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="s1">'autopilot/data'</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path_autopilot</span><span class="p">)</span>
<span class="n">autopilot_train_s3_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>'s3://sagemaker-us-east-1-491783890788/autopilot/data/womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv'</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the existence of the dataset in this S3 bucket folder:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>aws s3 ls <span class="nv">$autopilot_train_s3_uri</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2023-02-05 14:47:43    2253749 womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="S3-output-for-generated-assets">
<a class="anchor" href="#S3-output-for-generated-assets" aria-hidden="true"><span class="octicon octicon-link"></span></a>S3 output for generated assets<a class="anchor-link" href="#S3-output-for-generated-assets"> </a>
</h3>
<p>Set the S3 output path for the Autopilot outputs. This includes Jupyter notebooks (analysis), Python scripts (feature engineering), and trained models.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_output_s3_uri</span> <span class="o">=</span> <span class="s1">'s3://</span><span class="si">{}</span><span class="s1">/autopilot'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_output_s3_uri</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>s3://sagemaker-us-east-1-491783890788/autopilot
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-the-Autopilot-job">
<a class="anchor" href="#Configure-the-Autopilot-job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the Autopilot job<a class="anchor-link" href="#Configure-the-Autopilot-job"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's now create the Autopilot job name.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="n">auto_ml_job_name</span> <span class="o">=</span> <span class="s1">'automl-dm-</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When configuring our Autopilot job, we need to specify the maximum number of candidates, <code>max_candidates</code>, to explore as well as the input/output S3 locations and target column to predict. In this case, we want to predict <code>sentiment</code> from the review text.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will create an instance of the <code>sagemaker.automl.automl.AutoML</code> estimator class passing the required configuration parameters. Target attribute for predictions here is <code>sentiment</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_candidates</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">automl</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">automl</span><span class="o">.</span><span class="n">automl</span><span class="o">.</span><span class="n">AutoML</span><span class="p">(</span>
    <span class="n">target_attribute_name</span><span class="o">=</span><span class="s1">'sentiment'</span><span class="p">,</span> 
    <span class="n">base_job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">,</span> 
    <span class="n">output_path</span><span class="o">=</span><span class="n">model_output_s3_uri</span><span class="p">,</span> 
    <span class="n">max_candidates</span><span class="o">=</span><span class="n">max_candidates</span><span class="p">,</span>
    <span class="n">sagemaker_session</span><span class="o">=</span><span class="n">sess</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
    <span class="n">max_runtime_per_training_job_in_seconds</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">total_job_runtime_in_seconds</span><span class="o">=</span><span class="mi">7200</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Launch-the-Autopilot-job">
<a class="anchor" href="#Launch-the-Autopilot-job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Launch the Autopilot job<a class="anchor-link" href="#Launch-the-Autopilot-job"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we call the  <code>fit</code> function of the configured estimator passing the S3 bucket input data path and the Autopilot job name.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">autopilot_train_s3_uri</span><span class="p">,</span> 
    <span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">,</span> 
    <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
    <span class="n">logs</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Track-Autopilot-job-progress">
<a class="anchor" href="#Track-Autopilot-job-progress" aria-hidden="true"><span class="octicon octicon-link"></span></a>Track Autopilot job progress<a class="anchor-link" href="#Track-Autopilot-job-progress"> </a>
</h2>
<p>Once the Autopilot job has been launched, we can track the job progress directly from the notebook using the SDK capabilities.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Autopilot-job-description">
<a class="anchor" href="#Autopilot-job-description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autopilot job description<a class="anchor-link" href="#Autopilot-job-description"> </a>
</h3>
<p>Function <code>describe_auto_ml_job</code> of the Amazon SageMaker service returns the information about the AutoML job in dictionary format. We can review the response syntax and response elements in the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_DescribeAutoMLJob.html"><strong>documentation</strong></a>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Autopilot-job-status">
<a class="anchor" href="#Autopilot-job-status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autopilot job status<a class="anchor-link" href="#Autopilot-job-status"> </a>
</h3>
<p>To track the job progress we can use two response elements: <code>AutoMLJobStatus</code> and <code>AutoMLJobSecondaryStatus</code>, which correspond to the primary (Completed | InProgress | Failed | Stopped | Stopping) and secondary (AnalyzingData | FeatureEngineering | ModelTuning etc.) job states respectively. To see if the AutoML job has started, we can check the existence of the <code>AutoMLJobStatus</code> and <code>AutoMLJobSecondaryStatus</code> elements in the job description response.</p>
<p>We will use the following scheme to track the job progress:</p>
<div class="highlight"><pre><span></span><span class="c1"># check if the job is still at certain stage</span>
<span class="k">while</span> <span class="p">[</span><span class="n">check</span> <span class="s1">'AutoMLJobStatus'</span> <span class="ow">and</span> <span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">job_description_response</span><span class="p">:</span>
    <span class="c1"># update the job description response</span>
    <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">AutoMLJobName</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="c1"># print the message the Autopilot job is in the stage ...</span>
    <span class="nb">print</span><span class="p">([</span><span class="n">message</span><span class="p">])</span>
    <span class="c1"># get a time step to check the status again</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Autopilot job complete..."</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="s1">'AutoMLJobStatus'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_description_response</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">'AutoMLJobSecondaryStatus'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_description_response</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job has not yet started. Please wait. '</span><span class="p">)</span>
    <span class="c1"># function `json.dumps` encodes JSON string for printing.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Waiting for Autopilot job to start...'</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] AutoML job started.'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] AutoML job started.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Review-the-SageMaker-processing-jobs">
<a class="anchor" href="#Review-the-SageMaker-processing-jobs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Review the SageMaker processing jobs<a class="anchor-link" href="#Review-the-SageMaker-processing-jobs"> </a>
</h3>
<p>The Autopilot creates the required SageMaker processing jobs during the run:</p>
<ul>
<li>First processing job (data splitter) checks the data sanity, performs stratified shuffling and splits the data into training and validation. </li>
<li>Second processing job (candidate generator) first streams through the data to compute statistics for the dataset. Then, uses these statistics to identify the problem type, and possible types of every column-predictor: numeric, categorical, natural language, etc.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Wait-for-the-data-analysis-step-to-finish">
<a class="anchor" href="#Wait-for-the-data-analysis-step-to-finish" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wait for the data analysis step to finish<a class="anchor-link" href="#Wait-for-the-data-analysis-step-to-finish"> </a>
</h3>
<p>Here we will use the same scheme as above to check the completion of the data analysis step. This step can be identified with the (primary) job status value <code>InProgress</code> and secondary job status values <code>Starting</code> and then <code>AnalyzingData</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
<span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>

<span class="k">if</span> <span class="n">job_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Stopped'</span><span class="p">,</span> <span class="s1">'Failed'</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">job_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'InProgress'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">job_sec_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Starting'</span><span class="p">,</span> <span class="s1">'AnalyzingData'</span><span class="p">):</span>
        <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
        <span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">job_status</span><span class="p">,</span> <span class="n">job_sec_status</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] Data analysis phase completed.</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>InProgress FeatureEngineering
[OK] Data analysis phase completed.

{
    "AutoMLJobArn": "arn:aws:sagemaker:us-east-1:491783890788:automl-job/automl-dm-1675608463",
    "AutoMLJobArtifacts": {
        "CandidateDefinitionNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotCandidateDefinitionNotebook.ipynb",
        "DataExplorationNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotDataExplorationNotebook.ipynb"
    },
    "AutoMLJobConfig": {
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "SecurityConfig": {
            "EnableInterContainerTrafficEncryption": false
        }
    },
    "AutoMLJobName": "automl-dm-1675608463",
    "AutoMLJobSecondaryStatus": "FeatureEngineering",
    "AutoMLJobStatus": "InProgress",
    "CreationTime": "2023-02-05 14:47:43.853000+00:00",
    "GenerateCandidateDefinitionsOnly": false,
    "InputDataConfig": [
        {
            "ChannelType": "training",
            "ContentType": "text/csv;header=present",
            "DataSource": {
                "S3DataSource": {
                    "S3DataType": "S3Prefix",
                    "S3Uri": "s3://sagemaker-us-east-1-491783890788/auto-ml-input-data/womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv"
                }
            },
            "TargetAttributeName": "sentiment"
        }
    ],
    "LastModifiedTime": "2023-02-05 14:56:15.134000+00:00",
    "OutputDataConfig": {
        "S3OutputPath": "s3://sagemaker-us-east-1-491783890788/autopilot"
    },
    "ResolvedAttributes": {
        "AutoMLJobObjective": {
            "MetricName": "Accuracy"
        },
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "ProblemType": "MulticlassClassification"
    },
    "ResponseMetadata": {
        "HTTPHeaders": {
            "content-length": "1815",
            "content-type": "application/x-amz-json-1.1",
            "date": "Sun, 05 Feb 2023 14:56:16 GMT",
            "x-amzn-requestid": "0faeba6e-7645-46d4-a41d-658ebc1167e8"
        },
        "HTTPStatusCode": 200,
        "RequestId": "0faeba6e-7645-46d4-a41d-658ebc1167e8",
        "RetryAttempts": 0
    },
    "RoleArn": "arn:aws:iam::491783890788:role/sagemaker-studio-vpc-firewall-us-east-1-sagemaker-execution-role"
}
CPU times: user 26.6 ms, sys: 43 µs, total: 26.7 ms
Wall time: 15.2 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="View-generated-notebooks">
<a class="anchor" href="#View-generated-notebooks" aria-hidden="true"><span class="octicon octicon-link"></span></a>View generated notebooks<a class="anchor-link" href="#View-generated-notebooks"> </a>
</h3>
<p>Once data analysis is complete, SageMaker AutoPilot generates two notebooks:</p>
<ul>
<li><a href="https://nbviewer.org/github/pranath/pds/blob/main/SageMakerAutopilotDataExplorationNotebook.ipynb">Data exploration</a></li>
<li><a href="https://nbviewer.org/github/pranath/pds/blob/main/SageMakerAutopilotCandidateDefinitionNotebook.ipynb">Candidate definition</a></li>
</ul>
<p>Notebooks are included in the AutoML job artifacts generated during the run. Before checking the existence of the notebooks, we can check if the artifacts have been generated.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use the status check scheme described above. The generation of artifacts can be identified by existence of <code>AutoMLJobArtifacts</code> element in the keys of the job description response.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>  

<span class="c1"># keep in the while loop until the Autopilot job artifacts will be generated</span>
<span class="k">while</span> <span class="s1">'AutoMLJobArtifacts'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_description_response</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
    <span class="c1"># update the information about the running Autopilot job</span>
    <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job has not yet generated the artifacts. Please wait. '</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Waiting for AutoMLJobArtifacts...'</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] AutoMLJobArtifacts generated.'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] AutoMLJobArtifacts generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to wait for Autopilot to make the notebooks available.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will again use the status check scheme described above. Notebooks creation can be identified by existence of <code>DataExplorationNotebookLocation</code> element in the keys of the <code>job_description_response['AutoMLJobArtifacts']</code> dictionary.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span> 

<span class="c1"># keep in the while loop until the notebooks will be created</span>
<span class="k">while</span> <span class="s1">'DataExplorationNotebookLocation'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobArtifacts'</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
    <span class="c1"># update the information about the running Autopilot job</span>
    <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job has not yet generated the notebooks. Please wait. '</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Waiting for DataExplorationNotebookLocation...'</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] DataExplorationNotebookLocation found.'</span><span class="p">)</span>   
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] DataExplorationNotebookLocation found.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We could review the generated resources in S3 directly. We can find the notebooks in the folder <code>notebooks</code> and download them by clicking on object <code>Actions</code>/<code>Object actions</code> -&gt; <code>Download as</code>/<code>Download</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Feature-engineering">
<a class="anchor" href="#Feature-engineering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Feature engineering<a class="anchor-link" href="#Feature-engineering"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use the status check scheme described above. The feature engineering step can be identified with the (primary) job status value <code>InProgress</code> and secondary job status value <code>FeatureEngineering</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
<span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
<span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_status</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_sec_status</span><span class="p">)</span>
<span class="k">if</span> <span class="n">job_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Stopped'</span><span class="p">,</span> <span class="s1">'Failed'</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">job_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'InProgress'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">job_sec_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'FeatureEngineering'</span><span class="p">):</span> 
        <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
        <span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">job_status</span><span class="p">,</span> <span class="n">job_sec_status</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] Feature engineering phase completed.</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>InProgress
FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress FeatureEngineering
InProgress ModelTuning
[OK] Feature engineering phase completed.

{
    "AutoMLJobArn": "arn:aws:sagemaker:us-east-1:491783890788:automl-job/automl-dm-1675608463",
    "AutoMLJobArtifacts": {
        "CandidateDefinitionNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotCandidateDefinitionNotebook.ipynb",
        "DataExplorationNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotDataExplorationNotebook.ipynb"
    },
    "AutoMLJobConfig": {
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "SecurityConfig": {
            "EnableInterContainerTrafficEncryption": false
        }
    },
    "AutoMLJobName": "automl-dm-1675608463",
    "AutoMLJobSecondaryStatus": "ModelTuning",
    "AutoMLJobStatus": "InProgress",
    "CreationTime": "2023-02-05 14:47:43.853000+00:00",
    "GenerateCandidateDefinitionsOnly": false,
    "InputDataConfig": [
        {
            "ChannelType": "training",
            "ContentType": "text/csv;header=present",
            "DataSource": {
                "S3DataSource": {
                    "S3DataType": "S3Prefix",
                    "S3Uri": "s3://sagemaker-us-east-1-491783890788/auto-ml-input-data/womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv"
                }
            },
            "TargetAttributeName": "sentiment"
        }
    ],
    "LastModifiedTime": "2023-02-05 15:04:28.632000+00:00",
    "OutputDataConfig": {
        "S3OutputPath": "s3://sagemaker-us-east-1-491783890788/autopilot"
    },
    "ResolvedAttributes": {
        "AutoMLJobObjective": {
            "MetricName": "Accuracy"
        },
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "ProblemType": "MulticlassClassification"
    },
    "ResponseMetadata": {
        "HTTPHeaders": {
            "content-length": "1808",
            "content-type": "application/x-amz-json-1.1",
            "date": "Sun, 05 Feb 2023 15:04:28 GMT",
            "x-amzn-requestid": "eecffe9b-ef5e-4e69-b4ca-d0b0b3a95be7"
        },
        "HTTPStatusCode": 200,
        "RequestId": "eecffe9b-ef5e-4e69-b4ca-d0b0b3a95be7",
        "RetryAttempts": 0
    },
    "RoleArn": "arn:aws:iam::491783890788:role/sagemaker-studio-vpc-firewall-us-east-1-sagemaker-execution-role"
}
CPU times: user 378 ms, sys: 49.3 ms, total: 427 ms
Wall time: 7min 7s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-training-and-tuning">
<a class="anchor" href="#Model-training-and-tuning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model training and tuning<a class="anchor-link" href="#Model-training-and-tuning"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use the status check scheme described above. the model tuning step can be identified with the (primary) job status value <code>InProgress</code> and secondary job status value <code>ModelTuning</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
<span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
<span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_status</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_sec_status</span><span class="p">)</span>
<span class="k">if</span> <span class="n">job_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Stopped'</span><span class="p">,</span> <span class="s1">'Failed'</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">job_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'InProgress'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">job_sec_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'ModelTuning'</span><span class="p">):</span> 
        <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
        <span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">job_status</span><span class="p">,</span> <span class="n">job_sec_status</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] Model tuning phase completed.</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>InProgress
ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress ModelTuning
InProgress MaxCandidatesReached
[OK] Model tuning phase completed.

{
    "AutoMLJobArn": "arn:aws:sagemaker:us-east-1:491783890788:automl-job/automl-dm-1675608463",
    "AutoMLJobArtifacts": {
        "CandidateDefinitionNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotCandidateDefinitionNotebook.ipynb",
        "DataExplorationNotebookLocation": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotDataExplorationNotebook.ipynb"
    },
    "AutoMLJobConfig": {
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "SecurityConfig": {
            "EnableInterContainerTrafficEncryption": false
        }
    },
    "AutoMLJobName": "automl-dm-1675608463",
    "AutoMLJobSecondaryStatus": "MaxCandidatesReached",
    "AutoMLJobStatus": "InProgress",
    "BestCandidate": {
        "CandidateName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
        "CandidateProperties": {
            "CandidateMetrics": [
                {
                    "MetricName": "F1macro",
                    "Set": "Validation",
                    "StandardMetricName": "F1macro",
                    "Value": 0.6152600049972534
                },
                {
                    "MetricName": "PrecisionMacro",
                    "Set": "Validation",
                    "StandardMetricName": "PrecisionMacro",
                    "Value": 0.6158699989318848
                },
                {
                    "MetricName": "Accuracy",
                    "Set": "Validation",
                    "StandardMetricName": "Accuracy",
                    "Value": 0.6150500178337097
                },
                {
                    "MetricName": "BalancedAccuracy",
                    "Set": "Validation",
                    "StandardMetricName": "BalancedAccuracy",
                    "Value": 0.6150500178337097
                },
                {
                    "MetricName": "LogLoss",
                    "Set": "Validation",
                    "StandardMetricName": "LogLoss",
                    "Value": 0.843940019607544
                },
                {
                    "MetricName": "RecallMacro",
                    "Set": "Validation",
                    "StandardMetricName": "RecallMacro",
                    "Value": 0.6150500178337097
                }
            ]
        },
        "CandidateStatus": "Completed",
        "CandidateSteps": [
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepName": "automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepType": "AWS::SageMaker::ProcessingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
                "CandidateStepName": "automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
                "CandidateStepName": "automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
                "CandidateStepType": "AWS::SageMaker::TransformJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
                "CandidateStepName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            }
        ],
        "CreationTime": "2023-02-05 15:06:01+00:00",
        "EndTime": "2023-02-05 15:07:54+00:00",
        "FinalAutoMLJobObjectiveMetric": {
            "MetricName": "validation:accuracy",
            "Value": 0.6150500178337097
        },
        "InferenceContainers": [
            {
                "Environment": {
                    "AUTOML_SPARSE_ENCODE_RECORDIO_PROTOBUF": "1",
                    "AUTOML_TRANSFORM_MODE": "feature-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "application/x-recordio-protobuf",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
            },
            {
                "Environment": {
                    "MAX_CONTENT_LENGTH": "20971520",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,probabilities"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp2-xgb/automl-dm-1675608463sujxUg8wYQX0-002-657fba80/output/model.tar.gz"
            },
            {
                "Environment": {
                    "AUTOML_TRANSFORM_MODE": "inverse-label-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_INPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,labels,probabilities",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
            }
        ],
        "LastModifiedTime": "2023-02-05 15:09:06.585000+00:00",
        "ObjectiveStatus": "Succeeded"
    },
    "CreationTime": "2023-02-05 14:47:43.853000+00:00",
    "GenerateCandidateDefinitionsOnly": false,
    "InputDataConfig": [
        {
            "ChannelType": "training",
            "ContentType": "text/csv;header=present",
            "DataSource": {
                "S3DataSource": {
                    "S3DataType": "S3Prefix",
                    "S3Uri": "s3://sagemaker-us-east-1-491783890788/auto-ml-input-data/womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv"
                }
            },
            "TargetAttributeName": "sentiment"
        }
    ],
    "LastModifiedTime": "2023-02-05 15:09:06.661000+00:00",
    "OutputDataConfig": {
        "S3OutputPath": "s3://sagemaker-us-east-1-491783890788/autopilot"
    },
    "ResolvedAttributes": {
        "AutoMLJobObjective": {
            "MetricName": "Accuracy"
        },
        "CompletionCriteria": {
            "MaxAutoMLJobRuntimeInSeconds": 7200,
            "MaxCandidates": 3,
            "MaxRuntimePerTrainingJobInSeconds": 1200
        },
        "ProblemType": "MulticlassClassification"
    },
    "ResponseMetadata": {
        "HTTPHeaders": {
            "content-length": "5731",
            "content-type": "application/x-amz-json-1.1",
            "date": "Sun, 05 Feb 2023 15:09:06 GMT",
            "x-amzn-requestid": "d6af6156-cd79-4bf4-8025-52c85f36afa3"
        },
        "HTTPStatusCode": 200,
        "RequestId": "d6af6156-cd79-4bf4-8025-52c85f36afa3",
        "RetryAttempts": 0
    },
    "RoleArn": "arn:aws:iam::491783890788:role/sagemaker-studio-vpc-firewall-us-east-1-sagemaker-execution-role"
}
CPU times: user 241 ms, sys: 24.9 ms, total: 266 ms
Wall time: 4min 12s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we can check the completion of the Autopilot job looking for the <code>Completed</code> job status.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">job_description_response</span><span class="p">)</span>
<span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
<span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Job status:  </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_status</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Secondary job status:  </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_sec_status</span><span class="p">))</span>
<span class="k">if</span> <span class="n">job_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Stopped'</span><span class="p">,</span> <span class="s1">'Failed'</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">job_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'Completed'</span><span class="p">):</span>
        <span class="n">job_description_response</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">describe_auto_ml_job</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
        <span class="n">job_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobStatus'</span><span class="p">]</span>
        <span class="n">job_sec_status</span> <span class="o">=</span> <span class="n">job_description_response</span><span class="p">[</span><span class="s1">'AutoMLJobSecondaryStatus'</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Job status:  </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_status</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'Secondary job status:  </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_sec_status</span><span class="p">))</span>        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] Autopilot job completed.</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Job status: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Secondary job status: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">job_status</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{'AutoMLJobArn': 'arn:aws:sagemaker:us-east-1:491783890788:automl-job/automl-dm-1675608463',
 'AutoMLJobArtifacts': {'CandidateDefinitionNotebookLocation': 's3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotCandidateDefinitionNotebook.ipynb',
                        'DataExplorationNotebookLocation': 's3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/sagemaker-automl-candidates/automl-dm-1675608463-pr-1-210c7900f5854fdc89ce01c59579c034fb883/notebooks/SageMakerAutopilotDataExplorationNotebook.ipynb'},
 'AutoMLJobConfig': {'CompletionCriteria': {'MaxAutoMLJobRuntimeInSeconds': 7200,
                                            'MaxCandidates': 3,
                                            'MaxRuntimePerTrainingJobInSeconds': 1200},
                     'SecurityConfig': {'EnableInterContainerTrafficEncryption': False}},
 'AutoMLJobName': 'automl-dm-1675608463',
 'AutoMLJobSecondaryStatus': 'MergingAutoMLTaskReports',
 'AutoMLJobStatus': 'InProgress',
 'BestCandidate': {'CandidateName': 'automl-dm-1675608463sujxUg8wYQX0-002-657fba80',
                   'CandidateProperties': {'CandidateMetrics': [{'MetricName': 'F1macro',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'F1macro',
                                                                 'Value': 0.6152600049972534},
                                                                {'MetricName': 'PrecisionMacro',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'PrecisionMacro',
                                                                 'Value': 0.6158699989318848},
                                                                {'MetricName': 'Accuracy',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'Accuracy',
                                                                 'Value': 0.6150500178337097},
                                                                {'MetricName': 'BalancedAccuracy',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'BalancedAccuracy',
                                                                 'Value': 0.6150500178337097},
                                                                {'MetricName': 'LogLoss',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'LogLoss',
                                                                 'Value': 0.843940019607544},
                                                                {'MetricName': 'RecallMacro',
                                                                 'Set': 'Validation',
                                                                 'StandardMetricName': 'RecallMacro',
                                                                 'Value': 0.6150500178337097}]},
                   'CandidateStatus': 'Completed',
                   'CandidateSteps': [{'CandidateStepArn': 'arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5',
                                       'CandidateStepName': 'automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5',
                                       'CandidateStepType': 'AWS::SageMaker::ProcessingJob'},
                                      {'CandidateStepArn': 'arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a',
                                       'CandidateStepName': 'automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a',
                                       'CandidateStepType': 'AWS::SageMaker::TrainingJob'},
                                      {'CandidateStepArn': 'arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd',
                                       'CandidateStepName': 'automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd',
                                       'CandidateStepType': 'AWS::SageMaker::TransformJob'},
                                      {'CandidateStepArn': 'arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-002-657fba80',
                                       'CandidateStepName': 'automl-dm-1675608463sujxUg8wYQX0-002-657fba80',
                                       'CandidateStepType': 'AWS::SageMaker::TrainingJob'}],
                   'CreationTime': datetime.datetime(2023, 2, 5, 15, 6, 1, tzinfo=tzlocal()),
                   'EndTime': datetime.datetime(2023, 2, 5, 15, 7, 54, tzinfo=tzlocal()),
                   'FinalAutoMLJobObjectiveMetric': {'MetricName': 'validation:accuracy',
                                                     'Value': 0.6150500178337097},
                   'InferenceContainers': [{'Environment': {'AUTOML_SPARSE_ENCODE_RECORDIO_PROTOBUF': '1',
                                                            'AUTOML_TRANSFORM_MODE': 'feature-transform',
                                                            'SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT': 'application/x-recordio-protobuf',
                                                            'SAGEMAKER_PROGRAM': 'sagemaker_serve',
                                                            'SAGEMAKER_SUBMIT_DIRECTORY': '/opt/ml/model/code'},
                                            'Image': '683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3',
                                            'ModelDataUrl': 's3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz'},
                                           {'Environment': {'MAX_CONTENT_LENGTH': '20971520',
                                                            'SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT': 'text/csv',
                                                            'SAGEMAKER_INFERENCE_OUTPUT': 'predicted_label',
                                                            'SAGEMAKER_INFERENCE_SUPPORTED': 'predicted_label,probability,probabilities'},
                                            'Image': '683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3',
                                            'ModelDataUrl': 's3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp2-xgb/automl-dm-1675608463sujxUg8wYQX0-002-657fba80/output/model.tar.gz'},
                                           {'Environment': {'AUTOML_TRANSFORM_MODE': 'inverse-label-transform',
                                                            'SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT': 'text/csv',
                                                            'SAGEMAKER_INFERENCE_INPUT': 'predicted_label',
                                                            'SAGEMAKER_INFERENCE_OUTPUT': 'predicted_label',
                                                            'SAGEMAKER_INFERENCE_SUPPORTED': 'predicted_label,probability,labels,probabilities',
                                                            'SAGEMAKER_PROGRAM': 'sagemaker_serve',
                                                            'SAGEMAKER_SUBMIT_DIRECTORY': '/opt/ml/model/code'},
                                            'Image': '683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3',
                                            'ModelDataUrl': 's3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz'}],
                   'LastModifiedTime': datetime.datetime(2023, 2, 5, 15, 9, 6, 585000, tzinfo=tzlocal()),
                   'ObjectiveStatus': 'Succeeded'},
 'CreationTime': datetime.datetime(2023, 2, 5, 14, 47, 43, 853000, tzinfo=tzlocal()),
 'GenerateCandidateDefinitionsOnly': False,
 'InputDataConfig': [{'ChannelType': 'training',
                      'ContentType': 'text/csv;header=present',
                      'DataSource': {'S3DataSource': {'S3DataType': 'S3Prefix',
                                                      'S3Uri': 's3://sagemaker-us-east-1-491783890788/auto-ml-input-data/womens_clothing_ecommerce_reviews_balanced_for_autopilot.csv'}},
                      'TargetAttributeName': 'sentiment'}],
 'LastModifiedTime': datetime.datetime(2023, 2, 5, 15, 9, 7, 862000, tzinfo=tzlocal()),
 'OutputDataConfig': {'S3OutputPath': 's3://sagemaker-us-east-1-491783890788/autopilot'},
 'ResolvedAttributes': {'AutoMLJobObjective': {'MetricName': 'Accuracy'},
                        'CompletionCriteria': {'MaxAutoMLJobRuntimeInSeconds': 7200,
                                               'MaxCandidates': 3,
                                               'MaxRuntimePerTrainingJobInSeconds': 1200},
                        'ProblemType': 'MulticlassClassification'},
 'ResponseMetadata': {'HTTPHeaders': {'content-length': '5735',
                                      'content-type': 'application/x-amz-json-1.1',
                                      'date': 'Sun, 05 Feb 2023 15:09:27 GMT',
                                      'x-amzn-requestid': '5577738e-56f0-40ea-8ae0-9f4f512ecae8'},
                      'HTTPStatusCode': 200,
                      'RequestId': '5577738e-56f0-40ea-8ae0-9f4f512ecae8',
                      'RetryAttempts': 0},
 'RoleArn': 'arn:aws:iam::491783890788:role/sagemaker-studio-vpc-firewall-us-east-1-sagemaker-execution-role'}
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  InProgress
Secondary job status:  MergingAutoMLTaskReports
Job status:  Completed
Secondary job status:  Completed
[OK] Autopilot job completed.

CPU times: user 719 ms, sys: 63.7 ms, total: 783 ms
Wall time: 7min 59s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Compare-model-candidates">
<a class="anchor" href="#Compare-model-candidates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compare model candidates<a class="anchor-link" href="#Compare-model-candidates"> </a>
</h3>
<p>Once model tuning is complete, we can view all the candidates (pipeline evaluations with different hyperparameter combinations) that were explored by AutoML and sort them by their final performance metric.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will list candidates generated by Autopilot sorted by accuracy from highest to lowest.</p>
<p>To do this we will use the <code>list_candidates</code> function passing the Autopilot job name <code>auto_ml_job_name</code> with the accuracy field <code>FinalObjectiveMetricValue</code>. It returns the list of candidates with the information about them.</p>
<div class="highlight"><pre><span></span><span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span>
    <span class="n">job_name</span><span class="o">=...</span><span class="p">,</span> <span class="c1"># Autopilot job name</span>
    <span class="n">sort_by</span><span class="o">=</span><span class="s1">'...'</span> <span class="c1"># accuracy field name</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span>
    <span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">,</span> 
    <span class="n">sort_by</span><span class="o">=</span><span class="s1">'FinalObjectiveMetricValue'</span> 
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can review the response syntax and response elements of the function <code>list_candidates</code> in the <a href="https://docs.aws.amazon.com/sagemaker/latest/APIReference/API_AutoMLCandidate.html"><strong>documentation</strong></a>. Now let's put the candidate existence check into the loop:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="n">candidates</span> <span class="o">==</span> <span class="p">[]:</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job is generating the candidates. Please wait.'</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] Candidates generated.'</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] Candidates generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The information about each of the candidates is in the dictionary with the following keys:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dict_keys(['CandidateName', 'FinalAutoMLJobObjectiveMetric', 'ObjectiveStatus', 'CandidateSteps', 'CandidateStatus', 'InferenceContainers', 'CreationTime', 'EndTime', 'LastModifiedTime', 'CandidateProperties'])
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>CandidateName</code> contains the candidate name and the <code>FinalAutoMLJobObjectiveMetric</code> element contains the metric information which can be used to identify the best candidate later. Let's check that they were generated.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="s1">'CandidateName'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job is generating CandidateName. Please wait. '</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] CandidateName generated.'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] CandidateName generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="s1">'FinalAutoMLJobObjectiveMetric'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot job is generating FinalAutoMLJobObjectiveMetric. Please wait. '</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] FinalAutoMLJobObjectiveMetric generated.'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] FinalAutoMLJobObjectiveMetric generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[
    {
        "CandidateName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
        "CandidateProperties": {
            "CandidateArtifactLocations": {
                "Explainability": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/documentation/explainability/output",
                "ModelInsights": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/documentation/model_monitor/output"
            },
            "CandidateMetrics": [
                {
                    "MetricName": "F1macro",
                    "Set": "Validation",
                    "StandardMetricName": "F1macro",
                    "Value": 0.6152600049972534
                },
                {
                    "MetricName": "PrecisionMacro",
                    "Set": "Validation",
                    "StandardMetricName": "PrecisionMacro",
                    "Value": 0.6158699989318848
                },
                {
                    "MetricName": "Accuracy",
                    "Set": "Validation",
                    "StandardMetricName": "Accuracy",
                    "Value": 0.6150500178337097
                },
                {
                    "MetricName": "BalancedAccuracy",
                    "Set": "Validation",
                    "StandardMetricName": "BalancedAccuracy",
                    "Value": 0.6150500178337097
                },
                {
                    "MetricName": "LogLoss",
                    "Set": "Validation",
                    "StandardMetricName": "LogLoss",
                    "Value": 0.843940019607544
                },
                {
                    "MetricName": "RecallMacro",
                    "Set": "Validation",
                    "StandardMetricName": "RecallMacro",
                    "Value": 0.6150500178337097
                }
            ]
        },
        "CandidateStatus": "Completed",
        "CandidateSteps": [
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepName": "automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepType": "AWS::SageMaker::ProcessingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
                "CandidateStepName": "automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
                "CandidateStepName": "automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
                "CandidateStepType": "AWS::SageMaker::TransformJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
                "CandidateStepName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            }
        ],
        "CreationTime": "2023-02-05 15:06:01+00:00",
        "EndTime": "2023-02-05 15:07:54+00:00",
        "FinalAutoMLJobObjectiveMetric": {
            "MetricName": "validation:accuracy",
            "Value": 0.6150500178337097
        },
        "InferenceContainers": [
            {
                "Environment": {
                    "AUTOML_SPARSE_ENCODE_RECORDIO_PROTOBUF": "1",
                    "AUTOML_TRANSFORM_MODE": "feature-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "application/x-recordio-protobuf",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
            },
            {
                "Environment": {
                    "MAX_CONTENT_LENGTH": "20971520",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,probabilities"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp2-xgb/automl-dm-1675608463sujxUg8wYQX0-002-657fba80/output/model.tar.gz"
            },
            {
                "Environment": {
                    "AUTOML_TRANSFORM_MODE": "inverse-label-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_INPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,labels,probabilities",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
            }
        ],
        "LastModifiedTime": "2023-02-05 15:09:06.585000+00:00",
        "ObjectiveStatus": "Succeeded"
    },
    {
        "CandidateName": "automl-dm-1675608463sujxUg8wYQX0-001-5d775b4b",
        "CandidateProperties": {
            "CandidateMetrics": [
                {
                    "MetricName": "F1macro",
                    "Set": "Validation",
                    "StandardMetricName": "F1macro",
                    "Value": 0.6157000064849854
                },
                {
                    "MetricName": "PrecisionMacro",
                    "Set": "Validation",
                    "StandardMetricName": "PrecisionMacro",
                    "Value": 0.6168199777603149
                },
                {
                    "MetricName": "Accuracy",
                    "Set": "Validation",
                    "StandardMetricName": "Accuracy",
                    "Value": 0.6149100065231323
                },
                {
                    "MetricName": "BalancedAccuracy",
                    "Set": "Validation",
                    "StandardMetricName": "BalancedAccuracy",
                    "Value": 0.6149100065231323
                },
                {
                    "MetricName": "LogLoss",
                    "Set": "Validation",
                    "StandardMetricName": "LogLoss",
                    "Value": 0.8395400047302246
                },
                {
                    "MetricName": "RecallMacro",
                    "Set": "Validation",
                    "StandardMetricName": "RecallMacro",
                    "Value": 0.6149100065231323
                }
            ]
        },
        "CandidateStatus": "Completed",
        "CandidateSteps": [
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepName": "automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepType": "AWS::SageMaker::ProcessingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp0-1-b325f697683a4300957f609440a1906660e",
                "CandidateStepName": "automl-dm-1675608463-dpp0-1-b325f697683a4300957f609440a1906660e",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp0-rpb-1-57a73878e9f24b9dbe23bf82b200317",
                "CandidateStepName": "automl-dm-1675608463-dpp0-rpb-1-57a73878e9f24b9dbe23bf82b200317",
                "CandidateStepType": "AWS::SageMaker::TransformJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-001-5d775b4b",
                "CandidateStepName": "automl-dm-1675608463sujxUg8wYQX0-001-5d775b4b",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            }
        ],
        "CreationTime": "2023-02-05 15:05:53+00:00",
        "EndTime": "2023-02-05 15:07:46+00:00",
        "FinalAutoMLJobObjectiveMetric": {
            "MetricName": "validation:accuracy",
            "Value": 0.6149100065231323
        },
        "InferenceContainers": [
            {
                "Environment": {
                    "AUTOML_SPARSE_ENCODE_RECORDIO_PROTOBUF": "1",
                    "AUTOML_TRANSFORM_MODE": "feature-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "application/x-recordio-protobuf",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp0-1-b325f697683a4300957f609440a1906660e/output/model.tar.gz"
            },
            {
                "Environment": {
                    "MAX_CONTENT_LENGTH": "20971520",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,probabilities"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp0-xgb/automl-dm-1675608463sujxUg8wYQX0-001-5d775b4b/output/model.tar.gz"
            },
            {
                "Environment": {
                    "AUTOML_TRANSFORM_MODE": "inverse-label-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_INPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,labels,probabilities",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp0-1-b325f697683a4300957f609440a1906660e/output/model.tar.gz"
            }
        ],
        "LastModifiedTime": "2023-02-05 15:09:06.515000+00:00",
        "ObjectiveStatus": "Succeeded"
    },
    {
        "CandidateName": "automl-dm-1675608463sujxUg8wYQX0-003-a2d5723e",
        "CandidateProperties": {
            "CandidateMetrics": [
                {
                    "MetricName": "F1macro",
                    "Set": "Validation",
                    "StandardMetricName": "F1macro",
                    "Value": 0.39879000186920166
                },
                {
                    "MetricName": "PrecisionMacro",
                    "Set": "Validation",
                    "StandardMetricName": "PrecisionMacro",
                    "Value": 0.39879998564720154
                },
                {
                    "MetricName": "Accuracy",
                    "Set": "Validation",
                    "StandardMetricName": "Accuracy",
                    "Value": 0.3990600109100342
                },
                {
                    "MetricName": "BalancedAccuracy",
                    "Set": "Validation",
                    "StandardMetricName": "BalancedAccuracy",
                    "Value": 0.3990600109100342
                },
                {
                    "MetricName": "LogLoss",
                    "Set": "Validation",
                    "StandardMetricName": "LogLoss",
                    "Value": 1.2047499418258667
                },
                {
                    "MetricName": "RecallMacro",
                    "Set": "Validation",
                    "StandardMetricName": "RecallMacro",
                    "Value": 0.3990600109100342
                }
            ]
        },
        "CandidateStatus": "Completed",
        "CandidateSteps": [
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepName": "automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
                "CandidateStepType": "AWS::SageMaker::ProcessingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp1-1-8b1885df2d2546b0abb07a329d1fb466b29",
                "CandidateStepName": "automl-dm-1675608463-dpp1-1-8b1885df2d2546b0abb07a329d1fb466b29",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp1-csv-1-24672b27ae4440179a3b7b3070f05ec",
                "CandidateStepName": "automl-dm-1675608463-dpp1-csv-1-24672b27ae4440179a3b7b3070f05ec",
                "CandidateStepType": "AWS::SageMaker::TransformJob"
            },
            {
                "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-003-a2d5723e",
                "CandidateStepName": "automl-dm-1675608463sujxUg8wYQX0-003-a2d5723e",
                "CandidateStepType": "AWS::SageMaker::TrainingJob"
            }
        ],
        "CreationTime": "2023-02-05 15:06:13+00:00",
        "EndTime": "2023-02-05 15:08:50+00:00",
        "FinalAutoMLJobObjectiveMetric": {
            "MetricName": "validation:accuracy",
            "Value": 0.3990600109100342
        },
        "InferenceContainers": [
            {
                "Environment": {
                    "AUTOML_TRANSFORM_MODE": "feature-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "application/x-recordio-protobuf",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp1-1-8b1885df2d2546b0abb07a329d1fb466b29/output/model.tar.gz"
            },
            {
                "Environment": {
                    "MAX_CONTENT_LENGTH": "20971520",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,probabilities"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp1-xgb/automl-dm-1675608463sujxUg8wYQX0-003-a2d5723e/output/model.tar.gz"
            },
            {
                "Environment": {
                    "AUTOML_TRANSFORM_MODE": "inverse-label-transform",
                    "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                    "SAGEMAKER_INFERENCE_INPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                    "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,labels,probabilities",
                    "SAGEMAKER_PROGRAM": "sagemaker_serve",
                    "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
                },
                "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
                "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp1-1-8b1885df2d2546b0abb07a329d1fb466b29/output/model.tar.gz"
            }
        ],
        "LastModifiedTime": "2023-02-05 15:09:06.513000+00:00",
        "ObjectiveStatus": "Succeeded"
    }
]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can print the names of the candidates with their metric values:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"metric "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'FinalAutoMLJobObjectiveMetric'</span><span class="p">][</span><span class="s1">'MetricName'</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"  "</span> 
        <span class="o">+</span> <span class="n">candidate</span><span class="p">[</span><span class="s1">'CandidateName'</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"  "</span> 
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="s1">'FinalAutoMLJobObjectiveMetric'</span><span class="p">][</span><span class="s1">'Value'</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>metric validation:accuracy
0  automl-dm-1675608463sujxUg8wYQX0-002-657fba80  0.6150500178337097
1  automl-dm-1675608463sujxUg8wYQX0-001-5d775b4b  0.6149100065231323
2  automl-dm-1675608463sujxUg8wYQX0-003-a2d5723e  0.3990600109100342
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Review-best-candidate">
<a class="anchor" href="#Review-best-candidate" aria-hidden="true"><span class="octicon octicon-link"></span></a>Review best candidate<a class="anchor-link" href="#Review-best-candidate"> </a>
</h3>
<p>Now that we have successfully completed the Autopilot job on the dataset and visualized the trials, we can get the information about the best candidate model and review it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use the <code>best_candidate</code> function passing the Autopilot job name. <strong>Note</strong>: This function will give an error if candidates have not been generated.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">list_candidates</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>

<span class="k">if</span> <span class="n">candidates</span> <span class="o">!=</span> <span class="p">[]:</span>
    <span class="n">best_candidate</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">best_candidate</span><span class="p">(</span>
        <span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span> 
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">best_candidate</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
    "CandidateName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
    "CandidateProperties": {
        "CandidateArtifactLocations": {
            "Explainability": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/documentation/explainability/output",
            "ModelInsights": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/documentation/model_monitor/output"
        },
        "CandidateMetrics": [
            {
                "MetricName": "F1macro",
                "Set": "Validation",
                "StandardMetricName": "F1macro",
                "Value": 0.6152600049972534
            },
            {
                "MetricName": "PrecisionMacro",
                "Set": "Validation",
                "StandardMetricName": "PrecisionMacro",
                "Value": 0.6158699989318848
            },
            {
                "MetricName": "Accuracy",
                "Set": "Validation",
                "StandardMetricName": "Accuracy",
                "Value": 0.6150500178337097
            },
            {
                "MetricName": "BalancedAccuracy",
                "Set": "Validation",
                "StandardMetricName": "BalancedAccuracy",
                "Value": 0.6150500178337097
            },
            {
                "MetricName": "LogLoss",
                "Set": "Validation",
                "StandardMetricName": "LogLoss",
                "Value": 0.843940019607544
            },
            {
                "MetricName": "RecallMacro",
                "Set": "Validation",
                "StandardMetricName": "RecallMacro",
                "Value": 0.6150500178337097
            }
        ]
    },
    "CandidateStatus": "Completed",
    "CandidateSteps": [
        {
            "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:processing-job/automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
            "CandidateStepName": "automl-dm-1675608463-db-1-ec0fb37f4b964d1a9485854c252aa8f0683f5",
            "CandidateStepType": "AWS::SageMaker::ProcessingJob"
        },
        {
            "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
            "CandidateStepName": "automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a",
            "CandidateStepType": "AWS::SageMaker::TrainingJob"
        },
        {
            "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:transform-job/automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
            "CandidateStepName": "automl-dm-1675608463-dpp2-rpb-1-fd31c8d697b34a02a3472ce6d7557cd",
            "CandidateStepType": "AWS::SageMaker::TransformJob"
        },
        {
            "CandidateStepArn": "arn:aws:sagemaker:us-east-1:491783890788:training-job/automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
            "CandidateStepName": "automl-dm-1675608463sujxUg8wYQX0-002-657fba80",
            "CandidateStepType": "AWS::SageMaker::TrainingJob"
        }
    ],
    "CreationTime": "2023-02-05 15:06:01+00:00",
    "EndTime": "2023-02-05 15:07:54+00:00",
    "FinalAutoMLJobObjectiveMetric": {
        "MetricName": "validation:accuracy",
        "Value": 0.6150500178337097
    },
    "InferenceContainers": [
        {
            "Environment": {
                "AUTOML_SPARSE_ENCODE_RECORDIO_PROTOBUF": "1",
                "AUTOML_TRANSFORM_MODE": "feature-transform",
                "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "application/x-recordio-protobuf",
                "SAGEMAKER_PROGRAM": "sagemaker_serve",
                "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
            },
            "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
            "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
        },
        {
            "Environment": {
                "MAX_CONTENT_LENGTH": "20971520",
                "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,probabilities"
            },
            "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-xgboost:1.3-1-cpu-py3",
            "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/tuning/automl-dm--dpp2-xgb/automl-dm-1675608463sujxUg8wYQX0-002-657fba80/output/model.tar.gz"
        },
        {
            "Environment": {
                "AUTOML_TRANSFORM_MODE": "inverse-label-transform",
                "SAGEMAKER_DEFAULT_INVOCATIONS_ACCEPT": "text/csv",
                "SAGEMAKER_INFERENCE_INPUT": "predicted_label",
                "SAGEMAKER_INFERENCE_OUTPUT": "predicted_label",
                "SAGEMAKER_INFERENCE_SUPPORTED": "predicted_label,probability,labels,probabilities",
                "SAGEMAKER_PROGRAM": "sagemaker_serve",
                "SAGEMAKER_SUBMIT_DIRECTORY": "/opt/ml/model/code"
            },
            "Image": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-sklearn-automl:2.5-1-cpu-py3",
            "ModelDataUrl": "s3://sagemaker-us-east-1-491783890788/autopilot/automl-dm-1675608463/data-processor-models/automl-dm-1675608463-dpp2-1-f8c17915c5bd4efbb7862d503ce9d50304a/output/model.tar.gz"
        }
    ],
    "LastModifiedTime": "2023-02-05 15:09:06.585000+00:00",
    "ObjectiveStatus": "Succeeded"
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the existence of the candidate name for the best candidate.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="s1">'CandidateName'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_candidate</span><span class="p">:</span>
    <span class="n">best_candidate</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">best_candidate</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot Job is generating BestCandidate CandidateName. Please wait. '</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">best_candidate</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] BestCandidate CandidateName generated.'</span><span class="p">)</span>  
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] BestCandidate CandidateName generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the existence of the metric value for the best candidate.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">while</span> <span class="s1">'FinalAutoMLJobObjectiveMetric'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">best_candidate</span><span class="p">:</span>
    <span class="n">best_candidate</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">best_candidate</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">auto_ml_job_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'[INFO] Autopilot Job is generating BestCandidate FinalAutoMLJobObjectiveMetric. Please wait. '</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">best_candidate</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'[OK] BestCandidate FinalAutoMLJobObjectiveMetric generated.'</span><span class="p">)</span>  
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[OK] BestCandidate FinalAutoMLJobObjectiveMetric generated.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Print the information about the best candidate:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_candidate_identifier</span> <span class="o">=</span> <span class="n">best_candidate</span><span class="p">[</span><span class="s1">'CandidateName'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Candidate name: "</span> <span class="o">+</span> <span class="n">best_candidate_identifier</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Metric name: "</span> <span class="o">+</span> <span class="n">best_candidate</span><span class="p">[</span><span class="s1">'FinalAutoMLJobObjectiveMetric'</span><span class="p">][</span><span class="s1">'MetricName'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Metric value: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">best_candidate</span><span class="p">[</span><span class="s1">'FinalAutoMLJobObjectiveMetric'</span><span class="p">][</span><span class="s1">'Value'</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Candidate name: automl-dm-1675608463sujxUg8wYQX0-002-657fba80
Metric name: validation:accuracy
Metric value: 0.6150500178337097
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Review-all-output-in-S3-bucket">
<a class="anchor" href="#Review-all-output-in-S3-bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>Review all output in S3 bucket<a class="anchor-link" href="#Review-all-output-in-S3-bucket"> </a>
</h2>
<p>We can see the artifacts generated by Autopilot including the following:</p>

<pre><code>data-processor-models/        # "models" learned to transform raw data into features 
documentation/                # explainability and other documentation about your model
preprocessed-data/            # data for train and validation
sagemaker-automl-candidates/  # candidate models which autopilot compares
transformed-data/             # candidate-specific data for train and validation
tuning/                       # candidate-specific tuning results
validations/                  # validation results</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deploy-and-test-best-candidate-model">
<a class="anchor" href="#Deploy-and-test-best-candidate-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deploy and test best candidate model<a class="anchor-link" href="#Deploy-and-test-best-candidate-model"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Deploy-best-candidate-model">
<a class="anchor" href="#Deploy-best-candidate-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deploy best candidate model<a class="anchor-link" href="#Deploy-best-candidate-model"> </a>
</h3>
<p>While batch transformations are supported, we will deploy our model as a REST Endpoint in this example.</p>
<p>First, we need to customize the inference response. The inference containers generated by SageMaker Autopilot allow you to select the response content for predictions. By default the inference containers are configured to generate the <code>predicted_label</code>. But we can add <code>probability</code> into the list of inference response keys.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inference_response_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'predicted_label'</span><span class="p">,</span> <span class="s1">'probability'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we will create a SageMaker endpoint from the best candidate generated by Autopilot. Wait for SageMaker to deploy the endpoint.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autopilot_model</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">deploy</span><span class="p">(</span>
    <span class="n">initial_instance_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">instance_type</span><span class="o">=</span><span class="s1">'ml.m5.large'</span><span class="p">,</span>
    <span class="n">candidate</span><span class="o">=</span><span class="n">best_candidate</span><span class="p">,</span>
    <span class="n">inference_response_keys</span><span class="o">=</span><span class="n">inference_response_keys</span><span class="p">,</span>
    <span class="n">predictor_cls</span><span class="o">=</span><span class="n">sagemaker</span><span class="o">.</span><span class="n">predictor</span><span class="o">.</span><span class="n">Predictor</span><span class="p">,</span>
    <span class="n">serializer</span><span class="o">=</span><span class="n">sagemaker</span><span class="o">.</span><span class="n">serializers</span><span class="o">.</span><span class="n">JSONSerializer</span><span class="p">(),</span>
    <span class="n">deserializer</span><span class="o">=</span><span class="n">sagemaker</span><span class="o">.</span><span class="n">deserializers</span><span class="o">.</span><span class="n">JSONDeserializer</span><span class="p">()</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Endpoint name:  </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">autopilot_model</span><span class="o">.</span><span class="n">endpoint_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>-------!
Endpoint name:  sagemaker-sklearn-automl-2023-02-05-15-18-52-694
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-the-model">
<a class="anchor" href="#Test-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test the model<a class="anchor-link" href="#Test-the-model"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's invoke a few predictions for the actual reviews using the deployed endpoint to test our model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">review_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'This product is great!'</span><span class="p">,</span>
               <span class="s1">'OK, but not great.'</span><span class="p">,</span>
               <span class="s1">'This is not the right product.'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">review_list</span><span class="p">:</span>
    
    <span class="c1"># remove commas from the review since we're passing the inputs as a CSV</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">sm_runtime</span><span class="o">.</span><span class="n">invoke_endpoint</span><span class="p">(</span>
        <span class="n">EndpointName</span><span class="o">=</span><span class="n">autopilot_model</span><span class="o">.</span><span class="n">endpoint_name</span><span class="p">,</span> <span class="c1"># endpoint name</span>
        <span class="n">ContentType</span><span class="o">=</span><span class="s1">'text/csv'</span><span class="p">,</span> <span class="c1"># type of input data</span>
        <span class="n">Accept</span><span class="o">=</span><span class="s1">'text/csv'</span><span class="p">,</span> <span class="c1"># type of the inference in the response</span>
        <span class="n">Body</span><span class="o">=</span><span class="n">review</span> <span class="c1"># review text</span>
        <span class="p">)</span>

    <span class="n">response_body</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s1">'Body'</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">'Review: '</span><span class="p">,</span> <span class="n">review</span><span class="p">,</span> <span class="s1">' Predicated class: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_body</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"(-1 = Negative, 0=Neutral, 1=Positive)"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Review:  This product is great!  Predicated class: 1
Review:  OK but not great.  Predicated class: 0
Review:  This is not the right product.  Predicated class: -1
(-1 = Negative, 0=Neutral, 1=Positive)
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So we used Amazon SageMaker Autopilot to automatically find the best model, hyper-parameters, and feature-engineering scripts for our dataset. Autopilot uses a uniquely-transparent approach to AutoML by generating re-usable Python scripts and notebooks.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Acknowledgements">
<a class="anchor" href="#Acknowledgements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Acknowledgements<a class="anchor-link" href="#Acknowledgements"> </a>
</h2>
<p>I'd like to express my thanks to the great <a href="https://www.deeplearning.ai/courses/practical-data-science-specialization/">Deep Learning AI Practical Data Science on AWS Specialisation Course</a> which i completed, and acknowledge the use of some images and other materials from the training course in this article.</p>

</div>
</div>
</div>
</div>



  </div>
  
  <a class="u-url" href="/aws/cloud-data-science/natural-language-processing/2023/02/05/train-model-aws-sagemaker-autopilot.html" hidden></a>
</article><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="pranath/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>